<%	boolean isAuthenticated = false;	String token = request.getParameter("token");		// TODO: really needs to be some form of decrypt or unpack	// for now make a trivial test	String userId = token; 				isAuthenticated = ((token != null) && (token.length() > 0));	System.out.println("token to match is " + token);		StringBuffer xml = new StringBuffer("\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>");	if (isAuthenticated)	{		try {			boolean found = false;			javax.xml.parsers.DocumentBuilderFactory dbf = javax.xml.parsers.DocumentBuilderFactory.newInstance();			javax.xml.parsers.DocumentBuilder db = dbf.newDocumentBuilder();			org.w3c.dom.Document document = db.parse(new java.io.FileInputStream("../conf/MigrationProfiles.xml"));						org.w3c.dom.NodeList userNodeList = document.getElementsByTagName("user");						int numUserNodes = userNodeList.getLength();			for (int i=0; i < numUserNodes; i++) {				org.w3c.dom.Element userElement = (org.w3c.dom.Element)userNodeList.item(i);				String id = userElement.getAttribute("id");				if (id.equals(userId)) {					found = true;					org.w3c.dom.NodeList profilesNodeList = userElement.getElementsByTagName("profiles");								int numProfilesNodes = profilesNodeList.getLength();					if (numProfilesNodes > 0) {						org.w3c.dom.Element profilesElement = (org.w3c.dom.Element)profilesNodeList.item(0);						xml.append("\n<profiles>");												org.w3c.dom.NodeList profileNodeList = profilesElement.getElementsByTagName("profile");									int numProfileNodes = profileNodeList.getLength();						for (int j=0; j < numProfileNodes; j++) {							org.w3c.dom.Element profileElement = (org.w3c.dom.Element)profileNodeList.item(j);							xml.append("\n\t<profile>");														org.w3c.dom.NodeList displayNameNodeList = profileElement.getElementsByTagName("displayName");							int numDisplayNames = displayNameNodeList.getLength();							if (numDisplayNames > 0) {								org.w3c.dom.Element displayNameElement = (org.w3c.dom.Element)displayNameNodeList.item(0);								if (displayNameElement.hasChildNodes()) {									String value = displayNameElement.getFirstChild().getNodeValue();									xml.append("\n\t\t<displayName>");									xml.append(value);									xml.append("</displayName>");								}							}							xml.append("\n\t</profile>");						}						xml.append("\n</profiles>");					}				}        	}			if (!found) {				xml.append("\n<profiles/>");			}    	} catch (Throwable t) {}	} else {		//TODO: we should return an authentication error		xml.append("\n<profiles/>");	}	%>		<%=xml%>	<%%>